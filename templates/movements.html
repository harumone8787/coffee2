{% extends 'base.html' %}
{% block title %}入出庫 - 在庫管理{% endblock %}
{% block content %}
<h1>入出庫（消費登録）</h1>

<form method="post" class="grid-form">
  <div>
    <label>商品</label>
    <select name="product_id" required>
      {% for p in products %}
        <option value="{{ p.id }}">{{ p.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>区分</label>
    <select name="kind" required>
      <option value="IN">入庫</option>
      <option value="OUT">出庫</option>
    </select>
  </div>
  <div>
    <label>数量</label>
    <input type="number" name="qty" min="1" value="1" required>
  </div>
  <div>
    <label>メモ</label>
    <input name="note" placeholder="任意">
  </div>
  <div class="full">
    <button type="submit" class="button-accent">📝 記録する</button>
  </div>
</form>

<h2 class="mt-3">最近の履歴（50件）</h2>
<div class="table-responsive">
  <table class="table">
    <thead>
      <tr><th>日時</th><th>商品</th><th>区分</th><th>数量</th><th>担当</th><th>メモ</th></tr>
    </thead>
    <tbody>
      {% for m in recent %}
      <tr>
        <td>{{ m.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ m.product.name }}</td>
        <td>
          {% if m.kind == 'IN' %}
            <span class="icon icon-in">⬆️ 入庫</span>
          {% else %}
            <span class="icon icon-out">⬇️ 出庫</span>
          {% endif %}
        </td>
        <td>{{ m.qty }}</td>
        <td>
          {% if m.user.is_admin %}
            <span class="icon icon-admin" title="管理者">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 14a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5Z"/>
              </svg>
            </span>
          {% else %}
            <span class="icon icon-staff" title="スタッフ">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 14a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5Z"/>
              </svg>
            </span>
          {% endif %}
          <span style="margin-left:6px">{{ m.user.username }}</span>
        </td>
        <td>{{ m.note or '' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
